import{r as D,j as e}from"./index-B98PupNe.js";import{u as q,L as B,f as W,a as E,b as K}from"./api-CaqdZfy5.js";import{R as O,w as $,x as H,X as Y,Y as Q,T as U,t as X,z as F}from"./LineChart-DLf5VVJj.js";const G=()=>{let c=0,n=0;for(;c===0;)c=Math.random();for(;n===0;)n=Math.random();return Math.sqrt(-2*Math.log(c))*Math.cos(2*Math.PI*n)},_=(c,n,M=0)=>{const v=s=>s.price??s.close??s.close_price??0,u=(c||[]).map(s=>({ts:new Date(s.date).getTime(),value:v(s),isPrediction:!1}));if(!n)return u.sort((s,i)=>s.ts-i.ts);const d=new Date(n.year,(n.month||1)-1,n.day||1).getTime(),l=u.length?u[u.length-1]:null,j=(l==null?void 0:l.ts)??null,x=(l==null?void 0:l.value)??null,h=[];for(let s=1;s<(c||[]).length;s++){const i=v((c||[])[s-1]),g=v((c||[])[s]);i>0&&g>0&&h.push(Math.log(g/i))}const P=h.length?h.reduce((s,i)=>s+i,0)/h.length:0,C=h.length?h.reduce((s,i)=>s+(i-P)*(i-P),0)/h.length:0,N=Math.sqrt(C||0);if(j&&d>j&&x!=null){const s=M>0?d+M*24*60*60*1e3:d,i=Math.max(1,Math.round((s-j)/(1e3*60*60*24))),g=Math.max(1,Math.round(i/7)),w=Math.min(60,Math.max(8,g)),a=[];for(let o=1;o<=w;o++){const b=Math.round(j+(s-j)*o/w);let y;if(b<=d)y=x+(n.predictedPrice-x)*o/w;else{const k=(b-d)/Math.max(1,s-d);y=n.predictedPrice*(1+.002*k)}const f=G()*(N||0)*2,L=Math.max(1,y*Math.exp(f));a.push({ts:b,value:L,isPrediction:b>=d})}const T=a.findIndex(o=>o.ts===d);T>=0?a[T].value=n.predictedPrice:a.push({ts:d,value:n.predictedPrice,isPrediction:!0});const p=new Set(a.map(o=>o.ts));return[...u.filter(o=>!p.has(o.ts)),...a].sort((o,b)=>o.ts-b.ts)}else{const s=u.findIndex(i=>i.ts===d);return s>=0?u[s]={ts:d,value:n.predictedPrice,isPrediction:!0}:u.push({ts:d,value:n.predictedPrice,isPrediction:!0}),u.sort((i,g)=>i.ts-g.ts)}},S=c=>typeof c=="number"?`₹${c.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"—",ee=()=>{const{data:c,isLoading:n}=q({queryKey:["companies"],queryFn:W}),M=new Date,v=M.toISOString().split("T")[0],u=new Date(M);u.setDate(u.getDate()+1);const d=u.toISOString().split("T")[0],[l,j]=D.useState(""),[x,h]=D.useState(1e4),[P,C]=D.useState(d),[N,s]=D.useState(90),[i,g]=D.useState(180),{data:w}=q({queryKey:["historical",l],queryFn:()=>E(l),enabled:!!l}),{data:a,isLoading:T}=q({queryKey:["prediction",l,P],queryFn:async()=>{if(!l)return null;const t=new Date(P+"T00:00:00");return K(l,t.getFullYear(),t.getMonth()+1,t.getDate())},enabled:!!l}),p=D.useMemo(()=>_(w,a??void 0,N),[w,a,N]),r=D.useMemo(()=>{if(!p||p.length===0||!x||!a)return null;const t=new Date(a.year,(a.month||1)-1,a.day||1).getTime(),o=p.filter(m=>m.ts<=t);if(o.length===0)return null;const b=t-i*24*60*60*1e3;let y=o.filter(m=>m.ts>=b&&m.ts<=t);y.length===0&&(y=o);let f=y[0];for(const m of y)m.value<f.value&&(f=m);const L=t+N*24*60*60*1e3,k=p.filter(m=>m.ts>=t&&m.ts<=L);if(k.length===0)return{buyAt:f,sellAt:{ts:t,value:a.predictedPrice,isPrediction:!0},quantity:Math.floor(Number(x)/f.value)||0,expectedProfit:0,profitPerUnit:0};let A=k[0];for(const m of k)m.value>A.value&&(A=m);const I=Math.floor(Number(x)/f.value)||0,z=A.value-f.value,R=I*z;return{buyAt:f,predictionPoint:{ts:t,value:a.predictedPrice},sellAt:A,quantity:I,expectedProfit:R,profitPerUnit:z}},[p,x,a,N]);return n?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(B,{})}):e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-semibold",children:"Personalize — Buy/Sell Suggestion"})}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Stock"}),e.jsxs("select",{value:l,onChange:t=>j(t.target.value),className:"w-full border p-2 rounded",children:[e.jsx("option",{value:"",children:"Select a stock"}),c==null?void 0:c.map(t=>e.jsxs("option",{value:t.ticker,children:[t.ticker," — ",t.name]},t.ticker))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Amount to invest (₹)"}),e.jsx("input",{type:"number",value:x,onChange:t=>h(t.target.value===""?"":Number(t.target.value)),className:"w-full border p-2 rounded",min:1})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Prediction Date"}),e.jsx("input",{type:"date",value:P,min:v,onChange:t=>C(t.target.value>=v?t.target.value:v),className:"w-full border p-2 rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Sell horizon (days)"}),e.jsx("input",{type:"number",value:N,onChange:t=>s(Math.max(1,Number(t.target.value||1))),min:1,className:"w-full border p-2 rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Buy window (days)"}),e.jsx("input",{type:"number",value:i,onChange:t=>g(Math.max(1,Number(t.target.value||1))),min:1,className:"w-full border p-2 rounded"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2 bg-white p-6 rounded-xl border",children:e.jsx("div",{className:"h-64",children:l?!w&&T?e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx(B,{})}):e.jsx(O,{width:"100%",height:"100%",children:e.jsxs($,{data:p.map(t=>({date:t.ts,price:t.value})),margin:{top:10,right:20,left:10,bottom:20},children:[e.jsx(H,{strokeDasharray:"3 3",stroke:"#f3f4f6"}),e.jsx(Y,{dataKey:"date",type:"number",domain:["dataMin","dataMax"],tickFormatter:t=>new Date(t).toLocaleDateString("en-IN",{month:"short",year:"2-digit"})}),e.jsx(Q,{tickFormatter:t=>`₹${t}`}),e.jsx(U,{formatter:t=>S(Number(t)),labelFormatter:t=>new Date(t).toLocaleDateString()}),e.jsx(X,{type:"linear",dataKey:"price",stroke:"#2563eb",dot:p.length<=1?{r:4}:!1}),a&&e.jsx(F,{x:new Date(a.year,(a.month||1)-1,a.day||1).getTime(),y:a.predictedPrice,r:6,fill:"#16a34a",stroke:"#065f46",label:{position:"top",value:`Pred: ${S(a.predictedPrice)}`,fill:"#065f46",fontSize:11}}),r&&e.jsxs(e.Fragment,{children:[e.jsx(F,{x:r.buyAt.ts,y:r.buyAt.value,r:5,fill:"#2563eb",stroke:"#1e40af",label:{position:"bottom",value:"Buy",fill:"#1e40af",fontSize:11}}),e.jsx(F,{x:r.sellAt.ts,y:r.sellAt.value,r:5,fill:"#ef4444",stroke:"#b91c1c",label:{position:"top",value:"Sell",fill:"#b91c1c",fontSize:11}})]})]})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-gray-500",children:"Select a stock to view chart"})})}),e.jsxs("aside",{className:"bg-white p-6 rounded-xl border space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Recommendation"}),r?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:["Buy at: ",e.jsx("span",{className:"font-semibold",children:S(r.buyAt.value)})]}),e.jsxs("div",{className:"text-sm",children:["On: ",e.jsx("span",{className:"font-semibold",children:new Date(r.buyAt.ts).toLocaleDateString()})]}),e.jsxs("div",{className:"text-sm",children:["Prediction (",new Date(r.predictionPoint.ts).toLocaleDateString(),"): ",e.jsx("span",{className:"font-semibold text-indigo-600",children:S(r.predictionPoint.value)})]}),e.jsxs("div",{className:"text-sm",children:["Sell at: ",e.jsx("span",{className:"font-semibold",children:S(r.sellAt.value)})]}),e.jsxs("div",{className:"text-sm",children:["On: ",e.jsx("span",{className:"font-semibold",children:new Date(r.sellAt.ts).toLocaleDateString()})]}),e.jsxs("div",{className:"text-sm",children:["Quantity (approx): ",e.jsx("span",{className:"font-semibold",children:r.quantity})]}),e.jsxs("div",{className:"text-sm",children:["Expected profit: ",e.jsx("span",{className:`font-semibold ${r.expectedProfit>=0?"text-green-600":"text-red-600"}`,children:S(r.expectedProfit)})]})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"Enter amount and pick a stock to get a suggestion."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Notes"}),e.jsx("p",{className:"text-xs text-gray-500",children:"This is a heuristic suggestion based on historical volatility and a single predicted price. It does not constitute financial advice. Consider fees, taxes, and risks."})]})]})]})]})};export{ee as default};
