import{r as q,j as e,L as X}from"./index-B98PupNe.js";import{u as v,L as _,f as z,a as $,b as A}from"./api-CaqdZfy5.js";import{R as G,w as H,x as Q,X as J,Y as U,T as V,t as R,z as B,F as E}from"./LineChart-DLf5VVJj.js";const K=r=>r.price??r.close??r.close_price??0,Z=({data1:r,data2:L,pred1:c,pred2:g})=>{const u=()=>{let i=0,a=0;for(;i===0;)i=Math.random();for(;a===0;)a=Math.random();return Math.sqrt(-2*Math.log(i))*Math.cos(2*Math.PI*a)},N=(i,a)=>{const n=(i||[]).map(s=>({ts:new Date(s.date).getTime(),value:K(s),isPrediction:!1}));if(!a)return n.sort((s,o)=>s.ts-o.ts);const l=new Date(a.year,(a.month||1)-1,a.day||1).getTime(),d=n.length?n[n.length-1]:null,h=(d==null?void 0:d.ts)??null,D=(d==null?void 0:d.value)??null,m=[];for(let s=1;s<(i||[]).length;s++){const o=K((i||[])[s-1]),x=K((i||[])[s]);o>0&&x>0&&m.push(Math.log(x/o))}const F=m.length?m.reduce((s,o)=>s+o,0)/m.length:0,w=m.length?m.reduce((s,o)=>s+(o-F)*(o-F),0)/m.length:0,S=Math.sqrt(w||0);if(h&&l>h&&D!=null){const s=Math.max(1,Math.round((l-h)/864e5)),o=Math.max(1,Math.round(s/7)),x=Math.min(30,Math.max(6,o)),y=[];for(let j=1;j<=x;j++){const T=Math.round(h+(l-h)*j/x),Y=D+(a.predictedPrice-D)*j/x,O=u()*(S||0)*2,W=Math.max(1,Y*Math.exp(O));y.push({ts:T,value:W,isPrediction:!0})}y[y.length-1].value=a.predictedPrice;const t=new Set(y.map(j=>j.ts));return[...n.filter(j=>!t.has(j.ts)),...y].sort((j,T)=>j.ts-T.ts)}else{const s=n.findIndex(o=>o.ts===l);return s>=0?n[s]={ts:l,value:a.predictedPrice,isPrediction:!0}:n.push({ts:l,value:a.predictedPrice,isPrediction:!0}),n.sort((o,x)=>o.ts-x.ts)}},k=N(r,c),p=N(L,g),f=new Map,P=(i,a)=>{i.forEach(n=>{const l=f.get(n.ts)??{date:n.ts};l[a]=n.value,l[`${a}_isPred`]=n.isPrediction,f.set(n.ts,l)})};P(k,"p1"),P(p,"p2");const b=Array.from(f.values()).sort((i,a)=>i.date-a.date);if(!b.length)return e.jsx("div",{className:"h-64 flex items-center justify-center text-gray-500",children:"No data"});const C=({active:i,payload:a,label:n})=>{if(i&&a&&a.length){const l=new Date(n).toLocaleDateString();return e.jsxs("div",{className:"bg-white p-2 border rounded shadow",children:[e.jsx("div",{className:"text-sm text-gray-600",children:l}),a.map(d=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:`font-medium ${d.dataKey==="p1"?"text-blue-600":"text-purple-600"}`,children:[d.name,": "]}),"₹",Number(d.value||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]},d.dataKey))]})}return null};return e.jsx("div",{className:"w-full h-72",children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(H,{data:b,margin:{top:10,bottom:20,left:10,right:10},children:[e.jsx(Q,{strokeDasharray:"3 3",stroke:"#f3f4f6"}),e.jsx(J,{dataKey:"date",type:"number",domain:["dataMin","dataMax"],tickFormatter:i=>new Date(i).toLocaleDateString("en-IN",{month:"short",year:"2-digit"})}),e.jsx(U,{tickFormatter:i=>`₹${i}`}),e.jsx(V,{content:e.jsx(C,{})}),e.jsx(R,{type:"linear",dataKey:"p1",stroke:"#2563eb",dot:!1,name:"Stock 1"}),e.jsx(R,{type:"linear",dataKey:"p2",stroke:"#7c3aed",dot:!1,name:"Stock 2"}),c&&e.jsx(B,{x:new Date(c.year,(c.month||1)-1,c.day||1).getTime(),y:c.predictedPrice,r:6,fill:"#2563eb",stroke:"#1e40af"}),c&&e.jsx(E,{y:c.predictedPrice,stroke:"#2563eb",strokeDasharray:"4 4"}),g&&e.jsx(B,{x:new Date(g.year,(g.month||1)-1,g.day||1).getTime(),y:g.predictedPrice,r:6,fill:"#7c3aed",stroke:"#5b21b6"}),g&&e.jsx(E,{y:g.predictedPrice,stroke:"#7c3aed",strokeDasharray:"4 4"})]})})})},ae=()=>{const{data:r,isLoading:L}=v({queryKey:["companies"],queryFn:z}),[c,g]=q.useState(""),[u,N]=q.useState(""),k=new Date,p=k.toISOString().split("T")[0],f=new Date(k);f.setDate(f.getDate()+1);const P=f.toISOString().split("T")[0],[b,C]=q.useState(P),{data:i}=v({queryKey:["historical",c],queryFn:()=>$(c),enabled:!!c}),{data:a}=v({queryKey:["historical",u],queryFn:()=>$(u),enabled:!!u}),{year:n,month:l,day:d}=(()=>{const t=new Date(b+"T00:00:00");return{year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate()}})(),{data:h,isLoading:D}=v({queryKey:["prediction",c,n,l,d],queryFn:()=>c?A(c,n,l,d):Promise.resolve(null),enabled:!!c}),{data:m,isLoading:F}=v({queryKey:["prediction",u,n,l,d],queryFn:()=>u?A(u,n,l,d):Promise.resolve(null),enabled:!!u}),w=(r==null?void 0:r.find(t=>t.ticker===c))??null,S=(r==null?void 0:r.find(t=>t.ticker===u))??null,s=t=>typeof t=="number"?t.toLocaleString("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2,maximumFractionDigits:2}):"—",o=t=>{if(!t)return null;const M=t.predictedPrice-t.currentPrice,I=M/t.currentPrice*100;return{amount:M,percent:I,isPositive:M>0}},x=o(h),y=o(m);return L?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(_,{})}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Compare Stocks"}),e.jsx(X,{to:"/dashboard",className:"text-sm text-blue-600",children:"Back"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Stock A"}),e.jsxs("select",{value:c,onChange:t=>g(t.target.value),className:"w-full border p-2 rounded",children:[e.jsx("option",{value:"",children:"Select stock A"}),r==null?void 0:r.map(t=>e.jsxs("option",{value:t.ticker,children:[t.ticker," — ",t.name]},t.ticker))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Stock B"}),e.jsxs("select",{value:u,onChange:t=>N(t.target.value),className:"w-full border p-2 rounded",children:[e.jsx("option",{value:"",children:"Select stock B"}),r==null?void 0:r.map(t=>e.jsxs("option",{value:t.ticker,children:[t.ticker," — ",t.name]},t.ticker))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Prediction Date"}),e.jsx("input",{type:"date",value:b,min:p,onChange:t=>C(t.target.value>=p?t.target.value:p),className:"w-full border p-2 rounded"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 bg-white p-6 rounded-xl border",children:e.jsx(Z,{data1:i??[],data2:a??[],pred1:h,pred2:m})}),e.jsxs("aside",{className:"bg-white p-6 rounded-xl border space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Stock A"}),e.jsx("p",{className:"text-lg font-bold",children:w?w.ticker:"—"}),e.jsxs("p",{className:"text-sm",children:["Current: ",s(h==null?void 0:h.currentPrice)]}),e.jsxs("p",{className:"text-sm",children:["Predicted: ",s(h==null?void 0:h.predictedPrice)]}),e.jsxs("p",{className:"text-sm",children:["Expected: ",x?`${x.isPositive?"+":""}${x.percent.toFixed(2)}% (${s(x.amount)})`:"—"]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Stock B"}),e.jsx("p",{className:"text-lg font-bold",children:S?S.ticker:"—"}),e.jsxs("p",{className:"text-sm",children:["Current: ",s(m==null?void 0:m.currentPrice)]}),e.jsxs("p",{className:"text-sm",children:["Predicted: ",s(m==null?void 0:m.predictedPrice)]}),e.jsxs("p",{className:"text-sm",children:["Expected: ",y?`${y.isPositive?"+":""}${y.percent.toFixed(2)}% (${s(y.amount)})`:"—"]})]})]})]})]})};export{ae as default};
